Index: app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity2.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.actvities;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.AutoCompleteTextView;\r\nimport android.widget.ImageButton;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\n\r\nimport java.util.ArrayList;\r\n\r\nimport static com.example.dhruv.pg_accomodation.helper_classes.ValidationUtility.isValidMobile;\r\nimport static com.example.dhruv.pg_accomodation.helper_classes.ValidationUtility.isValidateCity;\r\n\r\npublic class RegisterActivity2 extends AppCompatActivity {\r\n\r\n    private ImageButton btnBack;\r\n    private MaterialButton btnNext;\r\n    private TextInputEditText phone;\r\n    private AutoCompleteTextView cityAutoTV;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_register2);\r\n        cityAutoTV= findViewById(R.id.cityTextView);\r\n\r\n        //initialize city dropdown list\r\n        initCityAdapterUI();\r\n\r\n\r\n        btnBack = findViewById(R.id.btn_back);\r\n        btnNext = findViewById(R.id.btn_next);\r\n\r\n        phone = findViewById(R.id.mobile_edittext);\r\n\r\n        //go back\r\n        btnBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(RegisterActivity2.this, RegisterActivity1.class));\r\n            }\r\n        });\r\n\r\n        // go next\r\n        btnNext.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                String mobile = phone.getText().toString();\r\n\r\n                if (isValidMobile(mobile)) {\r\n                    String city= cityAutoTV.getText().toString();\r\n                    if(isValidateCity(city)){\r\n                        String email = getIntent().getStringExtra(\"email\");\r\n                        String password = getIntent().getStringExtra(\"password\");\r\n                        Intent intent = new Intent(RegisterActivity2.this, RegisterActivity3.class);\r\n                        intent.putExtra(\"email\", email);\r\n                        intent.putExtra(\"password\", password);\r\n                        intent.putExtra(\"mobile\", mobile);\r\n                        intent.putExtra(\"city\", city);\r\n                        startActivity(intent);\r\n                    }else {\r\n                        cityAutoTV.setError(\"Invalid City Selected!\");\r\n                    }\r\n                } else {\r\n                    phone.setError(\"Invalid Mobile Number!\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        phone.setError(null);\r\n        cityAutoTV.setError(null);\r\n    }\r\n\r\n    private void initCityAdapterUI() {\r\n        ArrayList<String> cities = new ArrayList<>();\r\n        cities.add(\"Ahmedabad\");\r\n        cities.add(\"Gandhinagar\");\r\n        cities.add(\"Surat\");\r\n        cities.add(\"Vadodara\");\r\n        cities.add(\"Mehsana\");\r\n        cities.add(\"Modasa\");\r\n        cities.add(\"Junagadh\");\r\n        cities.add(\"Mumbai\");\r\n        ArrayAdapter<String> adapter = new ArrayAdapter<>(RegisterActivity2.this, android.R.layout.simple_spinner_dropdown_item, cities);\r\n        cityAutoTV.setAdapter(adapter);\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity2.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity2.java	(date 1620578642621)
@@ -34,7 +34,6 @@
         //initialize city dropdown list
         initCityAdapterUI();
 
-
         btnBack = findViewById(R.id.btn_back);
         btnNext = findViewById(R.id.btn_next);
 
@@ -65,6 +64,7 @@
                         intent.putExtra("mobile", mobile);
                         intent.putExtra("city", city);
                         startActivity(intent);
+                        finish();
                     }else {
                         cityAutoTV.setError("Invalid City Selected!");
                     }
@@ -95,5 +95,4 @@
         ArrayAdapter<String> adapter = new ArrayAdapter<>(RegisterActivity2.this, android.R.layout.simple_spinner_dropdown_item, cities);
         cityAutoTV.setAdapter(adapter);
     }
-
 }
\ No newline at end of file
Index: app/src/main/java/com/example/dhruv/pg_accomodation/fragments/ProfileFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.fragments;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.ContentResolver;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.webkit.MimeTypeMap;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.bumptech.glide.Glide;\r\nimport com.example.dhruv.pg_accomodation.helper_classes.ValidationUtility;\r\nimport com.example.dhruv.pg_accomodation.models.Post;\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.example.dhruv.pg_accomodation.models.UserModel;\r\nimport com.example.dhruv.pg_accomodation.adapters.ProfilePostAdapater;\r\nimport com.firebase.ui.database.FirebaseRecyclerOptions;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.material.textview.MaterialTextView;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.database.DataSnapshot;\r\nimport com.google.firebase.database.DatabaseError;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.ValueEventListener;\r\nimport com.google.firebase.storage.FirebaseStorage;\r\nimport com.google.firebase.storage.StorageReference;\r\nimport com.google.firebase.storage.UploadTask;\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AlertDialog;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.fragment.app.Fragment;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport static android.app.Activity.RESULT_OK;\r\n\r\npublic class ProfileFragment extends Fragment {\r\n\r\n\r\n    private Context context;\r\n    private TextView usernameTextView;\r\n    private TextView emailTextView;\r\n    private MaterialTextView mobileTextView;\r\n    private TextView changeProfilePic;\r\n    private ImageView profileImageView;\r\n\r\n    private Uri imageUri;\r\n    private ProfilePostAdapater postAdapter;\r\n    private StorageReference storageReference;\r\n    private FirebaseStorage firebaseStorage;\r\n    private RecyclerView postRecyclerView;\r\n    private String currentFirebaseUser;\r\n\r\n\r\n    public ProfileFragment() {}\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\r\n                             Bundle savedInstanceState) {\r\n        View view = inflater.inflate(R.layout.fragment_profile, container, false);\r\n        ((AppCompatActivity) getActivity()).getSupportActionBar().show();\r\n\r\n        //inisialization\r\n        usernameTextView = view.findViewById(R.id.profile_username);\r\n        emailTextView = view.findViewById(R.id.profile_emailid);\r\n        mobileTextView = view.findViewById(R.id.proflie_mobile_no_textView);\r\n        profileImageView = view.findViewById(R.id.profile_pic);\r\n        changeProfilePic = view.findViewById(R.id.change_profile_pic_textview);\r\n\r\n        firebaseStorage = FirebaseStorage.getInstance();\r\n        storageReference = firebaseStorage.getReference();\r\n        postRecyclerView = view.findViewById(R.id.post_recycleview);\r\n        currentFirebaseUser = FirebaseAuth.getInstance().getCurrentUser().getUid();\r\n        context = getContext();\r\n\r\n\r\n        //set posts uploaded by current user\r\n        postRecyclerView.setLayoutManager(new LinearLayoutManager(getContext()));\r\n        FirebaseRecyclerOptions<Post> options = new FirebaseRecyclerOptions.Builder<Post>().setQuery(FirebaseDatabase.getInstance().getReference()\r\n                .child(\"Posts\").orderByChild(\"postOwner\").equalTo(currentFirebaseUser), Post.class).build();\r\n        postAdapter = new ProfilePostAdapater(options, getContext());\r\n        postRecyclerView.setAdapter(postAdapter);\r\n\r\n        // this code is to set user profile info\r\n        DatabaseReference databaseReference = FirebaseDatabase.getInstance().getReference(\"user\").child(currentFirebaseUser);\r\n        databaseReference.addValueEventListener(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                UserModel user = snapshot.getValue(UserModel.class);\r\n                usernameTextView.setText(user.getUsername());\r\n                emailTextView.setText(user.getEmail());\r\n                mobileTextView.setText(user.getMobileNumber());\r\n                Glide.with(profileImageView.getContext()).load(user.getProfileImage()).into(profileImageView);\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n                Toast.makeText(context, \"\" + error.getMessage(), Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n\r\n\r\n        changeProfilePic.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                createImageChooser();\r\n            }\r\n        });\r\n        return view;\r\n    }\r\n\r\n    private void createImageChooser() {\r\n        if (ValidationUtility.isInternetAvailable(getContext())) {\r\n            Intent intent = new Intent();\r\n            intent.setType(\"image/*\");\r\n            intent.setAction(Intent.ACTION_GET_CONTENT);\r\n            startActivityForResult(intent, 1);\r\n        } else {\r\n            Toast.makeText(context, \"You are offline!\", Toast.LENGTH_SHORT).show();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onStart() {\r\n        super.onStart();\r\n        postAdapter.startListening();\r\n    }\r\n\r\n    @Override\r\n    public void onStop() {\r\n        super.onStop();\r\n        postAdapter.stopListening();\r\n    }\r\n\r\n\r\n    @Override\r\n    public void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n        if (requestCode == 1 && resultCode == RESULT_OK && data != null && data.getData() != null) {\r\n            imageUri = data.getData();\r\n            Glide.with(context).load(imageUri).into(profileImageView);\r\n            uploadPicture();\r\n        }\r\n    }\r\n\r\n    public boolean isInternetConnected() {\r\n        try {\r\n            String command = \"ping -c 1 google.com\";\r\n            return (Runtime.getRuntime().exec(command).waitFor() == 0);\r\n        } catch (Exception e) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private void uploadPicture() {\r\n        if (imageUri == null) {\r\n            return;\r\n        }\r\n        final ProgressDialog progressDialog = new ProgressDialog(context);\r\n        progressDialog.setMessage(\"Processing...\");\r\n        progressDialog.show();\r\n        ContentResolver contentResolver = context.getContentResolver();\r\n        MimeTypeMap mime = MimeTypeMap.getSingleton();\r\n\r\n        //creating path and file name to store image\r\n        StorageReference postImageRef = storageReference.child(\"user-profiles\").child(FirebaseAuth.getInstance().getUid()).child(System.currentTimeMillis()\r\n                + \".\" + mime.getExtensionFromMimeType(contentResolver.getType(imageUri)));\r\n        postImageRef.putFile(imageUri)\r\n                .addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {\r\n                    @Override\r\n                    public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {\r\n                        taskSnapshot.getStorage().getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {\r\n                            @Override\r\n                            public void onSuccess(Uri uri) {\r\n                                Toast.makeText(context, uri.toString() + \"\", Toast.LENGTH_SHORT).show();\r\n                                DatabaseReference databaseReference = FirebaseDatabase.getInstance().getReference(\"user\").child(FirebaseAuth.getInstance().getUid()).child(\"profileImage\");\r\n                                databaseReference.setValue(uri.toString()).addOnSuccessListener(new OnSuccessListener<Void>() {\r\n                                    @Override\r\n                                    public void onSuccess(Void aVoid) {\r\n                                        progressDialog.dismiss();\r\n                                        Toast.makeText(context, \"Profile picture updated.\", Toast.LENGTH_SHORT).show();\r\n                                    }\r\n                                }).addOnFailureListener(new OnFailureListener() {\r\n                                    @Override\r\n                                    public void onFailure(@NonNull Exception e) {\r\n                                        progressDialog.dismiss();\r\n                                        Toast.makeText(context, e.getMessage() + \"\", Toast.LENGTH_SHORT).show();\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                })\r\n                .addOnFailureListener(new OnFailureListener() {\r\n                    @Override\r\n                    public void onFailure(@NonNull Exception exception) {\r\n                        progressDialog.dismiss();\r\n                        Toast.makeText(context, exception.getMessage(), Toast.LENGTH_SHORT).show();\r\n                    }\r\n                });\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/fragments/ProfileFragment.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/fragments/ProfileFragment.java	(date 1620576543473)
@@ -100,7 +100,7 @@
                 usernameTextView.setText(user.getUsername());
                 emailTextView.setText(user.getEmail());
                 mobileTextView.setText(user.getMobileNumber());
-                Glide.with(profileImageView.getContext()).load(user.getProfileImage()).into(profileImageView);
+                Glide.with(getContext()).load(user.getProfileImage()).into(profileImageView);
             }
 
             @Override
Index: app/src/main/java/com/example/dhruv/pg_accomodation/fragments/HomeFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.fragments;\r\n\r\nimport android.os.Bundle;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.fragment.app.Fragment;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.Toast;\r\n\r\nimport com.example.dhruv.pg_accomodation.adapters.PostAdapter2;\r\nimport com.example.dhruv.pg_accomodation.adapters.SearchPostAdapter;\r\nimport com.example.dhruv.pg_accomodation.models.Post;\r\nimport com.example.dhruv.pg_accomodation.adapters.PostAdapter;\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.example.dhruv.pg_accomodation.models.UserModel;\r\nimport com.firebase.ui.database.FirebaseRecyclerOptions;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.database.DataSnapshot;\r\nimport com.google.firebase.database.DatabaseError;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.ValueEventListener;\r\n\r\nimport java.util.ArrayList;\r\n\r\n\r\npublic class HomeFragment extends Fragment {\r\n\r\n    private RecyclerView recyclerView;\r\n    private String city;\r\n    private String userId;\r\n\r\n    public HomeFragment() {\r\n    }\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\r\n        View view = inflater.inflate(R.layout.fragment_home, container, false);\r\n        //hide action bar\r\n        ((AppCompatActivity) getActivity()).getSupportActionBar().hide();\r\n\r\n        //init\r\n        recyclerView = view.findViewById(R.id.city_post_recycleview);\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));\r\n\r\n        getCurrentCityAndUserId();\r\n        setupInitialFeed();\r\n        return view;\r\n    }//end of oncreateview\r\n\r\n    private void getCurrentCityAndUserId() {\r\n        DatabaseReference databaseReference = FirebaseDatabase.getInstance().getReference(\"user\").child(FirebaseAuth.getInstance().getCurrentUser().getUid());\r\n        databaseReference.addValueEventListener(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                UserModel user = snapshot.getValue(UserModel.class);\r\n                setLocalVariable(user.getCity(), user.getUserId());\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n                Toast.makeText(getContext(), error.getMessage() + \"\", Toast.LENGTH_SHORT).show();\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private void setLocalVariable(String city, String userId) {\r\n        this.city = city;\r\n        this.userId = userId;\r\n    }\r\n\r\n\r\n    private void setupInitialFeed() {\r\n        //get all data of all posts\r\n        DatabaseReference databaseReference = FirebaseDatabase.getInstance().getReference(\"Posts\");\r\n        databaseReference.addValueEventListener(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                Iterable<DataSnapshot> iterable = snapshot.getChildren();\r\n                ArrayList<Post> postArray = new ArrayList<>();\r\n                for (DataSnapshot d : iterable) {\r\n                    Post post = d.getValue(Post.class);\r\n                    postArray.add(post);\r\n                }\r\n                filterPosts(postArray);\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n                Toast.makeText(getContext(), error.getMessage(), Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void filterPosts(ArrayList<Post> postArrayList) {\r\n        ArrayList<Post> filteredPosts = new ArrayList<>();\r\n\r\n        for (Post post : postArrayList) {\r\n            if (post.getPostCity().equals(city) && post.getPostOwner().equals(userId)) {\r\n                filteredPosts.add(post);\r\n            }\r\n        }\r\n\r\n        for (Post post : postArrayList) {\r\n            if (!post.getPostOwner().equals(userId)) {\r\n                filteredPosts.add(post);\r\n            }\r\n        }\r\n        PostAdapter2 postRecyclerAdapter = new PostAdapter2(getContext(), filteredPosts);\r\n        recyclerView.setAdapter(postRecyclerAdapter);\r\n    }\r\n\r\n}//end of class
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/fragments/HomeFragment.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/fragments/HomeFragment.java	(date 1620560547298)
@@ -36,8 +36,7 @@
     private String city;
     private String userId;
 
-    public HomeFragment() {
-    }
+    public HomeFragment() { }
 
     @Override
     public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
Index: app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity3.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.actvities;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.ContentResolver;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.webkit.MimeTypeMap;\r\nimport android.widget.ImageButton;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AlertDialog;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.bumptech.glide.Glide;\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.example.dhruv.pg_accomodation.helper_classes.ValidationUtility;\r\nimport com.example.dhruv.pg_accomodation.models.UserModel;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\nimport com.google.firebase.auth.AuthResult;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.storage.FirebaseStorage;\r\nimport com.google.firebase.storage.StorageReference;\r\nimport com.google.firebase.storage.UploadTask;\r\n\r\nimport de.hdodenhof.circleimageview.CircleImageView;\r\n\r\nimport static com.example.dhruv.pg_accomodation.helper_classes.ValidationUtility.isValidUsername;\r\n\r\npublic class RegisterActivity3 extends AppCompatActivity {\r\n\r\n    private ImageButton btnBack;\r\n    private MaterialButton btnSignup;\r\n    private CircleImageView btnImage;\r\n    private TextInputEditText usernameEdittext;\r\n    private ProgressDialog progressDialog;\r\n    private TextView changeProfilePicTV;\r\n\r\n    //firebase code\r\n    private FirebaseAuth firebaseAuth;\r\n    private FirebaseUser currentUser;\r\n    private FirebaseDatabase firebaseDatabase;\r\n    private DatabaseReference databaseReference;\r\n    private FirebaseStorage firebaseStorage;\r\n    private StorageReference storageReference;\r\n\r\n\r\n    //User data model\r\n    private UserModel user;\r\n    private Uri imageUri;\r\n    private String imageUriString;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_register3);\r\n\r\n        progressDialog = new ProgressDialog(RegisterActivity3.this);\r\n\r\n\r\n        //firbase instance initialization\r\n        firebaseStorage = FirebaseStorage.getInstance();\r\n        storageReference = firebaseStorage.getReference();\r\n\r\n\r\n        firebaseAuth = FirebaseAuth.getInstance();\r\n        firebaseDatabase = FirebaseDatabase.getInstance();\r\n        databaseReference = firebaseDatabase.getReference().child(\"user\");\r\n        user = new UserModel();\r\n\r\n        btnBack = findViewById(R.id.btn_back);\r\n        btnSignup = findViewById(R.id.btn_signup);\r\n        changeProfilePicTV = findViewById(R.id.profile_pic_textview);\r\n\r\n        btnImage = findViewById(R.id.profile_pic);\r\n        usernameEdittext = findViewById(R.id.username_edittext);\r\n\r\n        // go back btn\r\n        btnBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(RegisterActivity3.this, RegisterActivity2.class));\r\n            }\r\n        });\r\n\r\n        //select profile picture btn\r\n        btnImage.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                Intent intent = new Intent();\r\n                intent.setType(\"image/*\");\r\n                intent.setAction(Intent.ACTION_GET_CONTENT);\r\n                startActivityForResult(intent, 1);\r\n            }\r\n        });\r\n\r\n        //sign up btn\r\n        btnSignup.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                processSignup();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void processSignup() {\r\n        if (ValidationUtility.isInternetAvailable(this)){\r\n            String username = usernameEdittext.getText().toString();\r\n            if (isValidUsername(username)) {\r\n                confirmSignup();\r\n            } else {\r\n                usernameEdittext.setError(\"Invalid username!\");\r\n            }\r\n        } else {\r\n            Toast.makeText(this, \"You are offline!\", Toast.LENGTH_LONG).show();\r\n        }\r\n    }\r\n\r\n    private void showConfirmationMessage() {\r\n        AlertDialog.Builder builder1 = new AlertDialog.Builder(RegisterActivity3.this);\r\n        builder1.setMessage(\"Please verify email and login with your credentials!\");\r\n        builder1.setCancelable(true);\r\n        builder1.setPositiveButton(\r\n                \"OK\",\r\n                new DialogInterface.OnClickListener() {\r\n                    public void onClick(DialogInterface dialog, int id) {\r\n                        startActivity(new Intent(RegisterActivity3.this, LoginActivity.class).addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK));\r\n                        finish();\r\n                        dialog.cancel();\r\n                    }\r\n                });\r\n\r\n        AlertDialog alert11 = builder1.create();\r\n        alert11.show();\r\n    }\r\n\r\n    private void uploadUserProfile() {\r\n\r\n        progressDialog.setMessage(\"Processing...\");\r\n        progressDialog.show();\r\n        prepareUserProfile();\r\n        firebaseAuth.createUserWithEmailAndPassword(user.getEmail(), user.getPassword()).addOnCompleteListener(RegisterActivity3.this, new OnCompleteListener<AuthResult>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<AuthResult> task) {\r\n                if (task.isSuccessful()) {\r\n                    currentUser = firebaseAuth.getCurrentUser();\r\n                    if (currentUser != null) {\r\n                        final String userId = currentUser.getUid();\r\n                        user.setUserId(userId);\r\n                        //upload profile image\r\n                        uploadPicture();\r\n                        databaseReference.child(user.getUserId()).setValue(user).addOnSuccessListener(new OnSuccessListener<Void>() {\r\n                            @Override\r\n                            public void onSuccess(Void aVoid) {\r\n                                //send email verification\r\n                                progressDialog.setMessage(\"Sending verification mail...\");\r\n                                currentUser.sendEmailVerification().addOnSuccessListener(new OnSuccessListener<Void>() {\r\n                                    @Override\r\n                                    public void onSuccess(Void aVoid) {\r\n                                        progressDialog.dismiss();\r\n                                        showConfirmationMessage();\r\n                                    }\r\n                                }).addOnFailureListener(new OnFailureListener() {\r\n                                    @Override\r\n                                    public void onFailure(@NonNull Exception e) {\r\n                                        progressDialog.dismiss();\r\n                                        Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show();\r\n                                    }\r\n                                });\r\n                            }\r\n                        }).addOnFailureListener(new OnFailureListener() {\r\n                            @Override\r\n                            public void onFailure(@NonNull Exception e) {\r\n                                Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }).addOnFailureListener(new OnFailureListener() {\r\n            @Override\r\n            public void onFailure(@NonNull Exception e) {\r\n                progressDialog.dismiss();\r\n                Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_LONG).show();\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n    private void confirmSignup() {\r\n\r\n        AlertDialog.Builder builder1 = new AlertDialog.Builder(RegisterActivity3.this);\r\n        builder1.setTitle(\"Confirmation\");\r\n        builder1.setMessage(\"Email verification is necessary to use our services. To confirm please click \\\"OK\\\" and check your inbox!\");\r\n        builder1.setPositiveButton(\r\n                \"OK\",\r\n                new DialogInterface.OnClickListener() {\r\n                    public void onClick(DialogInterface dialog, int id) {\r\n                        uploadUserProfile();\r\n                        dialog.cancel();\r\n                    }\r\n                });\r\n\r\n        builder1.setNegativeButton(\r\n                \"Cancel\",\r\n                new DialogInterface.OnClickListener() {\r\n                    public void onClick(DialogInterface dialog, int id) {\r\n\r\n                        startActivity(new Intent(RegisterActivity3.this, WelcomeActivity.class));\r\n                        finish();\r\n                        dialog.cancel();\r\n                    }\r\n                });\r\n\r\n        AlertDialog alert11 = builder1.create();\r\n        alert11.show();\r\n    }\r\n\r\n    private void prepareUserProfile() {\r\n        String email = getIntent().getStringExtra(\"email\");\r\n        String password = getIntent().getStringExtra(\"password\");\r\n        String mobile = getIntent().getStringExtra(\"mobile\");\r\n        String city = getIntent().getStringExtra(\"city\");\r\n        String username = usernameEdittext.getText().toString();\r\n        user.setEmail(email);\r\n        user.setPassword(password);\r\n        user.setMobileNumber(mobile);\r\n        user.setCity(city);\r\n        if(imageUriString==null){\r\n            //default user profile link\r\n            imageUriString=\"https://firebasestorage.googleapis.com/v0/b/pghunter-c0bcb.appspot.com/o/user-profiles%2Fdefault-user-profile-pic%2Fdeafult-user-profile-picture.png?alt=media&token=fed865fc-fab3-4648-ae69-899788475774\";\r\n        }\r\n        user.setProfileImage(imageUriString);\r\n        user.setUsername(username);\r\n    }\r\n\r\n    private void setLocalVaribale(String string) {\r\n        imageUriString = string;\r\n    }\r\n\r\n    private void uploadPicture() {\r\n        if(imageUri==null){\r\n            return;\r\n        }\r\n        ContentResolver contentResolver = getContentResolver();\r\n        MimeTypeMap mime = MimeTypeMap.getSingleton();\r\n\r\n        //creating path and file name to store image\r\n        StorageReference postImageRef = storageReference.child(\"user-profiles\").child(FirebaseAuth.getInstance().getUid()).child(System.currentTimeMillis()\r\n                + \".\" + mime.getExtensionFromMimeType(contentResolver.getType(imageUri)));\r\n        postImageRef.putFile(imageUri)\r\n                .addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {\r\n                    @Override\r\n                    public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {\r\n                        taskSnapshot.getStorage().getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {\r\n                            @Override\r\n                            public void onSuccess(Uri uri) {\r\n                                setLocalVaribale(uri.toString());\r\n                                prepareUserProfile();\r\n                            }\r\n                        });\r\n                    }\r\n                })\r\n                .addOnFailureListener(new OnFailureListener() {\r\n                    @Override\r\n                    public void onFailure(@NonNull Exception exception) {\r\n                        progressDialog.dismiss();\r\n                        Toast.makeText(RegisterActivity3.this, exception.getMessage(), Toast.LENGTH_SHORT).show();\r\n                    }\r\n                });\r\n    }\r\n\r\n    @Override\r\n    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n        if (requestCode == 1 && resultCode == RESULT_OK && data != null && data.getData() != null) {\r\n            imageUri = data.getData();\r\n            changeProfilePicTV.setVisibility(View.GONE);\r\n            Glide.with(RegisterActivity3.this).load(imageUri).into(btnImage);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        usernameEdittext.setError(null);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity3.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity3.java	(date 1620590327936)
@@ -59,7 +59,7 @@
 
 
     //User data model
-    private UserModel user;
+    private static UserModel user;
     private Uri imageUri;
     private String imageUriString;
 
@@ -117,7 +117,7 @@
     }
 
     private void processSignup() {
-        if (ValidationUtility.isInternetAvailable(this)){
+        if (ValidationUtility.isInternetAvailable(this)) {
             String username = usernameEdittext.getText().toString();
             if (isValidUsername(username)) {
                 confirmSignup();
@@ -151,7 +151,9 @@
 
         progressDialog.setMessage("Processing...");
         progressDialog.show();
+
         prepareUserProfile();
+
         firebaseAuth.createUserWithEmailAndPassword(user.getEmail(), user.getPassword()).addOnCompleteListener(RegisterActivity3.this, new OnCompleteListener<AuthResult>() {
             @Override
             public void onComplete(@NonNull Task<AuthResult> task) {
@@ -160,33 +162,55 @@
                     if (currentUser != null) {
                         final String userId = currentUser.getUid();
                         user.setUserId(userId);
-                        //upload profile image
-                        uploadPicture();
-                        databaseReference.child(user.getUserId()).setValue(user).addOnSuccessListener(new OnSuccessListener<Void>() {
-                            @Override
-                            public void onSuccess(Void aVoid) {
+
+                        //default profile image
+                        if (imageUri == null) {
+
+                            imageUriString = "https://firebasestorage.googleapis.com/v0/b/pghunter-c0bcb.appspot.com/o/user-profiles%2Fdefault-user-profile-pic%2Fdeafult-user-profile-picture.png?alt=media&token=fed865fc-fab3-4648-ae69-899788475774";
+                            user.setProfileImage(imageUriString);
+
+                            databaseReference.child(user.getUserId()).setValue(user).addOnSuccessListener(aVoid -> {
                                 //send email verification
                                 progressDialog.setMessage("Sending verification mail...");
-                                currentUser.sendEmailVerification().addOnSuccessListener(new OnSuccessListener<Void>() {
-                                    @Override
-                                    public void onSuccess(Void aVoid) {
-                                        progressDialog.dismiss();
-                                        showConfirmationMessage();
-                                    }
-                                }).addOnFailureListener(new OnFailureListener() {
-                                    @Override
-                                    public void onFailure(@NonNull Exception e) {
-                                        progressDialog.dismiss();
-                                        Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show();
-                                    }
+                                currentUser.sendEmailVerification().addOnSuccessListener(aVoid12 -> {
+                                    progressDialog.dismiss();
+                                    showConfirmationMessage();
+                                }).addOnFailureListener(e -> {
+                                    progressDialog.dismiss();
+                                    Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show();
                                 });
-                            }
-                        }).addOnFailureListener(new OnFailureListener() {
-                            @Override
-                            public void onFailure(@NonNull Exception e) {
-                                Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show();
-                            }
-                        });
+                            }).addOnFailureListener(e -> Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show());
+
+                        } else {
+
+                            ContentResolver contentResolver = getContentResolver();
+                            MimeTypeMap mime = MimeTypeMap.getSingleton();
+
+                            //creating path and file name to store image
+                            StorageReference postImageRef = storageReference.child("user-profiles").child(userId).child(System.currentTimeMillis()
+                                    + "." + mime.getExtensionFromMimeType(contentResolver.getType(imageUri)));
+                            postImageRef.putFile(imageUri)
+                                    .addOnSuccessListener(taskSnapshot -> taskSnapshot.getStorage().getDownloadUrl().addOnSuccessListener(uri -> {
+
+                                        RegisterActivity3.user.setProfileImage(uri.toString());
+
+                                        databaseReference.child(user.getUserId()).setValue(user).addOnSuccessListener(aVoid -> {
+                                            //send email verification
+                                            progressDialog.setMessage("Sending verification mail...");
+                                            currentUser.sendEmailVerification().addOnSuccessListener(aVoid1 -> {
+                                                progressDialog.dismiss();
+                                                showConfirmationMessage();
+                                            }).addOnFailureListener(e -> {
+                                                progressDialog.dismiss();
+                                                Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show();
+                                            });
+                                        }).addOnFailureListener(e -> Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_SHORT).show());
+                                    }))
+                                    .addOnFailureListener(exception -> {
+                                        progressDialog.dismiss();
+                                        Toast.makeText(RegisterActivity3.this, exception.getMessage(), Toast.LENGTH_SHORT).show();
+                                    });
+                        }
                     }
                 }
             }
@@ -195,7 +219,6 @@
             public void onFailure(@NonNull Exception e) {
                 progressDialog.dismiss();
                 Toast.makeText(RegisterActivity3.this, e.getMessage(), Toast.LENGTH_LONG).show();
-
             }
         });
     }
@@ -239,50 +262,9 @@
         user.setPassword(password);
         user.setMobileNumber(mobile);
         user.setCity(city);
-        if(imageUriString==null){
-            //default user profile link
-            imageUriString="https://firebasestorage.googleapis.com/v0/b/pghunter-c0bcb.appspot.com/o/user-profiles%2Fdefault-user-profile-pic%2Fdeafult-user-profile-picture.png?alt=media&token=fed865fc-fab3-4648-ae69-899788475774";
-        }
-        user.setProfileImage(imageUriString);
         user.setUsername(username);
     }
 
-    private void setLocalVaribale(String string) {
-        imageUriString = string;
-    }
-
-    private void uploadPicture() {
-        if(imageUri==null){
-            return;
-        }
-        ContentResolver contentResolver = getContentResolver();
-        MimeTypeMap mime = MimeTypeMap.getSingleton();
-
-        //creating path and file name to store image
-        StorageReference postImageRef = storageReference.child("user-profiles").child(FirebaseAuth.getInstance().getUid()).child(System.currentTimeMillis()
-                + "." + mime.getExtensionFromMimeType(contentResolver.getType(imageUri)));
-        postImageRef.putFile(imageUri)
-                .addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {
-                    @Override
-                    public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {
-                        taskSnapshot.getStorage().getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {
-                            @Override
-                            public void onSuccess(Uri uri) {
-                                setLocalVaribale(uri.toString());
-                                prepareUserProfile();
-                            }
-                        });
-                    }
-                })
-                .addOnFailureListener(new OnFailureListener() {
-                    @Override
-                    public void onFailure(@NonNull Exception exception) {
-                        progressDialog.dismiss();
-                        Toast.makeText(RegisterActivity3.this, exception.getMessage(), Toast.LENGTH_SHORT).show();
-                    }
-                });
-    }
-
     @Override
     protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
         super.onActivityResult(requestCode, resultCode, data);
Index: app/src/main/java/com/example/dhruv/pg_accomodation/call_support/IncomingCallScreenActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.call_support;\r\n\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.sinch.android.rtc.MissingPermissionException;\r\nimport com.sinch.android.rtc.PushPair;\r\nimport com.sinch.android.rtc.calling.Call;\r\nimport com.sinch.android.rtc.calling.CallEndCause;\r\nimport com.sinch.android.rtc.calling.CallListener;\r\n\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.view.View.OnClickListener;\r\nimport android.widget.Button;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.core.app.ActivityCompat;\r\n\r\nimport java.util.List;\r\n\r\npublic class IncomingCallScreenActivity extends BaseActivity {\r\n\r\n    static final String TAG = IncomingCallScreenActivity.class.getSimpleName();\r\n    private String mCallId;\r\n    private AudioPlayer mAudioPlayer;\r\n    private String recepientName;\r\n    private String callerName;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.incoming);\r\n\r\n        recepientName=getIntent().getStringExtra(\"recepientName\");\r\n        callerName=getIntent().getStringExtra(\"callerName\");\r\n\r\n        MaterialButton answer =  findViewById(R.id.answerButton);\r\n        answer.setOnClickListener(mClickListener);\r\n        MaterialButton decline =findViewById(R.id.declineButton);\r\n        decline.setOnClickListener(mClickListener);\r\n\r\n        mAudioPlayer = new AudioPlayer(this);\r\n        mAudioPlayer.playRingtone();\r\n        mCallId = getIntent().getStringExtra(SinchService.CALL_ID);\r\n    }\r\n\r\n    @Override\r\n    protected void onServiceConnected() {\r\n        Call call = getSinchServiceInterface().getCall(mCallId);\r\n        if (call != null) {\r\n            call.addCallListener(new SinchCallListener());\r\n            TextView remoteUser = findViewById(R.id.remoteUser);\r\n            remoteUser.setText(callerName);\r\n        } else {\r\n            Log.e(TAG, \"Started with invalid callId, aborting\");\r\n            finish();\r\n        }\r\n    }\r\n\r\n    private void answerClicked() {\r\n        mAudioPlayer.stopRingtone();\r\n        Call call = getSinchServiceInterface().getCall(mCallId);\r\n        if (call != null) {\r\n            try {\r\n                call.answer();\r\n                Intent intent = new Intent(this, CallScreenActivity.class);\r\n                intent.putExtra(SinchService.CALL_ID, mCallId);\r\n                startActivity(intent);\r\n            } catch (MissingPermissionException e) {\r\n                ActivityCompat.requestPermissions(this, new String[]{e.getRequiredPermission()}, 0);\r\n            }\r\n        } else {\r\n            finish();\r\n        }\r\n    }\r\n\r\n    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {\r\n        if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {\r\n            Toast.makeText(this, \"You may now answer the call\", Toast.LENGTH_LONG).show();\r\n        } else {\r\n            Toast.makeText(this, \"This application needs permission to use your microphone to function properly.\", Toast\r\n                    .LENGTH_LONG).show();\r\n        }\r\n    }\r\n\r\n    private void declineClicked() {\r\n        mAudioPlayer.stopRingtone();\r\n        Call call = getSinchServiceInterface().getCall(mCallId);\r\n        if (call != null) {\r\n            call.hangup();\r\n        }\r\n        finish();\r\n    }\r\n\r\n    private class SinchCallListener implements CallListener {\r\n\r\n        @Override\r\n        public void onCallEnded(Call call) {\r\n            CallEndCause cause = call.getDetails().getEndCause();\r\n            Log.d(TAG, \"Call ended, cause: \" + cause.toString());\r\n            mAudioPlayer.stopRingtone();\r\n            finish();\r\n        }\r\n\r\n        @Override\r\n        public void onCallEstablished(Call call) {\r\n            Log.d(TAG, \"Call established\");\r\n        }\r\n\r\n        @Override\r\n        public void onCallProgressing(Call call) {\r\n            Log.d(TAG, \"Call progressing\");\r\n        }\r\n\r\n        @Override\r\n        public void onShouldSendPushNotification(Call call, List<PushPair> pushPairs) {\r\n            // Send a push through your push provider here, e.g. GCM\r\n        }\r\n\r\n    }\r\n\r\n    private OnClickListener mClickListener = new OnClickListener() {\r\n        @Override\r\n        public void onClick(View v) {\r\n            switch (v.getId()) {\r\n                case R.id.answerButton:\r\n                    answerClicked();\r\n                    break;\r\n                case R.id.declineButton:\r\n                    declineClicked();\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/call_support/IncomingCallScreenActivity.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/call_support/IncomingCallScreenActivity.java	(date 1620587015276)
@@ -55,6 +55,7 @@
             call.addCallListener(new SinchCallListener());
             TextView remoteUser = findViewById(R.id.remoteUser);
             remoteUser.setText(callerName);
+            //remoteUser.setText(call.getRemoteUserId());
         } else {
             Log.e(TAG, "Started with invalid callId, aborting");
             finish();
@@ -69,6 +70,7 @@
                 call.answer();
                 Intent intent = new Intent(this, CallScreenActivity.class);
                 intent.putExtra(SinchService.CALL_ID, mCallId);
+
                 startActivity(intent);
             } catch (MissingPermissionException e) {
                 ActivityCompat.requestPermissions(this, new String[]{e.getRequiredPermission()}, 0);
Index: app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/PrefManager.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.helper_classes;\r\n\r\nimport android.content.Context;\r\nimport android.content.SharedPreferences;\r\n\r\npublic class PrefManager {\r\n    private SharedPreferences pref;\r\n    private SharedPreferences.Editor editor;\r\n    private Context _context;\r\n    // shared pref mode\r\n    private int PRIVATE_MODE = 0;\r\n\r\n    private String callerID;\r\n    // Shared preferences file name\r\n    private static final String PREF_NAME = \"isLoggedIn\";\r\n\r\n    public PrefManager(Context context) {\r\n        this._context = context;\r\n        pref = _context.getSharedPreferences(PREF_NAME, PRIVATE_MODE);\r\n        editor = pref.edit();\r\n    }\r\n\r\n    public String getCallerID() {\r\n        callerID=pref.getString(\"callerID\",\"\");\r\n        return callerID;\r\n    }\r\n\r\n    public void setCallerID(String callerID) {\r\n        this.callerID = callerID;\r\n        editor.putString(\"callerID\",callerID);\r\n    }\r\n\r\n    public void setIsLoggedIn(boolean isLoggedIn) {\r\n        editor.putBoolean(PREF_NAME, isLoggedIn);\r\n        editor.commit();\r\n    }\r\n\r\n    public boolean isIsLoggedIn() {\r\n        return pref.getBoolean(PREF_NAME, false);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/PrefManager.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/PrefManager.java	(date 1620583289207)
@@ -11,6 +11,7 @@
     private int PRIVATE_MODE = 0;
 
     private String callerID;
+
     // Shared preferences file name
     private static final String PREF_NAME = "isLoggedIn";
 
@@ -20,6 +21,7 @@
         editor = pref.edit();
     }
 
+
     public String getCallerID() {
         callerID=pref.getString("callerID","");
         return callerID;
Index: app/src/main/java/com/example/dhruv/pg_accomodation/actvities/UploadPostActivity2.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.actvities;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport android.app.ProgressDialog;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.AutoCompleteTextView;\r\nimport android.widget.ImageView;\r\nimport android.widget.Toast;\r\n\r\nimport com.example.dhruv.pg_accomodation.Home;\r\nimport com.example.dhruv.pg_accomodation.models.Post;\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\n\r\nimport java.util.ArrayList;\r\n\r\npublic class UploadPostActivity2 extends AppCompatActivity {\r\n\r\n    private TextInputEditText postRentEditText;\r\n    private TextInputEditText postFacilityEditText;\r\n    private ImageView btnBack;\r\n    private MaterialButton btnUpload;\r\n    private ProgressDialog progressDialog;\r\n    private AutoCompleteTextView postTypeAutoTV;\r\n    private AutoCompleteTextView availabilityStatusTV,postCityAutoTV;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_upload_post2);\r\n        postTypeAutoTV = findViewById(R.id.postTypeTextView);\r\n        availabilityStatusTV = findViewById(R.id.availability_edittext);\r\n        postCityAutoTV=findViewById(R.id.post_city_uploadpost2);\r\n        initDropdownLists();\r\n\r\n        postRentEditText = findViewById(R.id.post_rent_edittext);\r\n        postFacilityEditText = findViewById(R.id.post_facility_edittext);\r\n        progressDialog = new ProgressDialog(UploadPostActivity2.this);\r\n\r\n        btnBack = findViewById(R.id.btn_back_uploadpost2);\r\n        btnUpload = findViewById(R.id.btn_upload);\r\n\r\n        btnBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(UploadPostActivity2.this, UploadPostActivity1.class));\r\n            }\r\n        });\r\n\r\n\r\n        btnUpload.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                progressDialog.setMessage(\"Processing...\");\r\n                progressDialog.show();\r\n\r\n                String address = getIntent().getStringExtra(\"address\");\r\n                String description = getIntent().getStringExtra(\"description\");\r\n                double lat = getIntent().getDoubleExtra(\"latitude\", 0.0d);\r\n                double logi = getIntent().getDoubleExtra(\"longitude\", 0.0d);\r\n                String imageString = getIntent().getStringExtra(\"imageUri\");\r\n\r\n\r\n                String rent = postRentEditText.getText().toString();\r\n                String facility = postFacilityEditText.getText().toString();\r\n                String ownerId = FirebaseAuth.getInstance().getCurrentUser().getUid();\r\n                String type = postTypeAutoTV.getText().toString();\r\n                String status = availabilityStatusTV.getText().toString();\r\n                String city=postCityAutoTV.getText().toString();\r\n\r\n                Post post = new Post();\r\n                post.setPostImage(imageString);\r\n                post.setPostAddress(address);\r\n                post.setPostDescription(description);\r\n                post.setFacility(facility);\r\n                post.setPostRent(rent);\r\n                post.setPostType(type);\r\n                post.setPostRatings(\"0.0\");\r\n                post.setPostOwner(ownerId);\r\n                post.setPostStatus(status);\r\n                post.setLat(lat + \"\");\r\n                post.setLongi(logi + \"\");\r\n                post.setPostCity(city);\r\n                saveDatatoDatabase(post);\r\n                progressDialog.dismiss();\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    private void initDropdownLists() {\r\n\r\n        //set post type dropdwon\r\n        ArrayList<String> availabilityList = new ArrayList<>();\r\n        availabilityList.add(\"Available Now\");\r\n        availabilityList.add(\"Available Soon\");\r\n        availabilityList.add(\"Not Available\");\r\n        availabilityStatusTV.setAdapter(new ArrayAdapter<>(UploadPostActivity2.this, android.R.layout.simple_spinner_dropdown_item, availabilityList));\r\n\r\n        //set post type\r\n        ArrayList<String> houseTypes = new ArrayList<>();\r\n\r\n        houseTypes.add(\"1-BHK Flat\");\r\n        houseTypes.add(\"1-BHK Row House\");\r\n\r\n\r\n        houseTypes.add(\"2-BHK Flat\");\r\n        houseTypes.add(\"2-BHK Row House\");;\r\n\r\n\r\n        houseTypes.add(\"3-BHK Flat\");\r\n        houseTypes.add(\"3-BHK Row House\");\r\n\r\n        houseTypes.add(\"Luxurious Bunglow\");\r\n        postTypeAutoTV.setAdapter(new ArrayAdapter<>(UploadPostActivity2.this, android.R.layout.simple_spinner_dropdown_item, houseTypes));\r\n\r\n\r\n        //set post city dropdwon\r\n        ArrayList<String> cities = new ArrayList<>();\r\n        cities.add(\"Ahmedabad\");\r\n        cities.add(\"Gandhinagar\");\r\n        cities.add(\"Vadodara\");\r\n        cities.add(\"Mehsana\");\r\n        cities.add(\"Modasa\");\r\n        cities.add(\"Surat\");\r\n        ArrayAdapter<String> adapter = new ArrayAdapter<>(UploadPostActivity2.this, android.R.layout.simple_spinner_dropdown_item, cities);\r\n        postCityAutoTV.setAdapter(adapter);\r\n    }\r\n\r\n\r\n    //save database\r\n    private void saveDatatoDatabase(final Post post) {\r\n\r\n        DatabaseReference databaseReference = FirebaseDatabase.getInstance().getReference(\"Posts\");\r\n        String postId = databaseReference.push().getKey();\r\n        post.setPostId(postId);\r\n\r\n        databaseReference.child(postId).setValue(post).addOnCompleteListener(new OnCompleteListener<Void>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<Void> task) {\r\n                if (task.isSuccessful()) {\r\n\r\n                    //upload data for likes\r\n                    DatabaseReference likeReference = FirebaseDatabase.getInstance().getReference(\"likes\");\r\n                    likeReference.child(post.getPostId()).setValue(true).addOnCompleteListener(new OnCompleteListener<Void>() {\r\n                        @Override\r\n                        public void onComplete(@NonNull Task<Void> task) {\r\n                            if (task.isSuccessful()) {\r\n                                progressDialog.dismiss();\r\n                                startActivity(new Intent(UploadPostActivity2.this, Home.class));\r\n                                finish();\r\n                            }\r\n                        }\r\n                    }).addOnFailureListener(new OnFailureListener() {\r\n                        @Override\r\n                        public void onFailure(@NonNull Exception e) {\r\n                            progressDialog.dismiss();\r\n                            Toast.makeText(UploadPostActivity2.this, e.getMessage(), Toast.LENGTH_LONG).show();\r\n\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }).addOnFailureListener(new OnFailureListener() {\r\n            @Override\r\n            public void onFailure(@NonNull Exception e) {\r\n                progressDialog.dismiss();\r\n                Toast.makeText(UploadPostActivity2.this, e.getMessage(), Toast.LENGTH_LONG).show();\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/actvities/UploadPostActivity2.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/actvities/UploadPostActivity2.java	(date 1620585875208)
@@ -97,7 +97,6 @@
                 progressDialog.dismiss();
             }
         });
-
     }
 
     private void initDropdownLists() {
Index: app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/BottomSheetDialog.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.helper_classes;\r\n\r\nimport android.app.Activity;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.os.Bundle;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.Button;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.core.app.ActivityCompat;\r\n\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.example.dhruv.pg_accomodation.actvities.CallActivity;\r\nimport com.example.dhruv.pg_accomodation.actvities.ChatActivity;\r\nimport com.example.dhruv.pg_accomodation.call_support.BaseActivity;\r\nimport com.example.dhruv.pg_accomodation.call_support.CallScreenActivity;\r\nimport com.example.dhruv.pg_accomodation.call_support.LoginActivity;\r\nimport com.example.dhruv.pg_accomodation.call_support.PlaceCallActivity;\r\nimport com.example.dhruv.pg_accomodation.call_support.SinchService;\r\nimport com.example.dhruv.pg_accomodation.models.Post;\r\nimport com.example.dhruv.pg_accomodation.models.UserListModel;\r\nimport com.google.android.material.bottomsheet.BottomSheetDialogFragment;\r\nimport com.google.firebase.database.DataSnapshot;\r\nimport com.google.firebase.database.DatabaseError;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.ValueEventListener;\r\nimport com.sinch.android.rtc.MissingPermissionException;\r\nimport com.sinch.android.rtc.calling.Call;\r\n\r\npublic class BottomSheetDialog extends BottomSheetDialogFragment {\r\n\r\n    private String chatId;\r\n    private String currentUserId;\r\n    private String ownerId;\r\n    private String recepientName;\r\n    private FirebaseDatabase firebaseDatabase;\r\n    private DatabaseReference databaseReference;\r\n    private String callerName;\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, @Nullable\r\n            ViewGroup container, @Nullable Bundle savedInstanceState) {\r\n        View v = inflater.inflate(R.layout.bottom_sheet_layout,\r\n                container, false);\r\n\r\n        Button callButton = v.findViewById(R.id.call_button);\r\n        Button chatButton = v.findViewById(R.id.chat_button);\r\n        firebaseDatabase = FirebaseDatabase.getInstance();\r\n\r\n        Bundle bundle = getArguments();\r\n        currentUserId = bundle.getString(\"firstuser\", \"\");\r\n        ownerId = bundle.getString(\"seconduser\", \"\");\r\n        chatId = bundle.getString(\"chatId\", \"\");\r\n        recepientName = bundle.getString(\"recepientName\", \"\");\r\n        callerName = bundle.getString(\"callerName\");\r\n\r\n        callButton.setOnClickListener(v1 -> {\r\n            processCall();\r\n            dismiss();\r\n        });\r\n\r\n        chatButton.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                processChat();\r\n                dismiss();\r\n            }\r\n        });\r\n\r\n        return v;\r\n    }\r\n\r\n    private void processCall() {\r\n        Intent intent = new Intent(getContext(), PlaceCallActivity.class);\r\n        intent.putExtra(\"recepientID\", ownerId);\r\n        intent.putExtra(\"recepientName\", recepientName);\r\n        intent.putExtra(\"callerName\", callerName);\r\n        startActivity(intent);\r\n    }\r\n\r\n    private void setChatId(String s) {\r\n        chatId = s;\r\n    }\r\n\r\n    private void processChat() {\r\n        Context context=getContext();\r\n        databaseReference = firebaseDatabase.getReference().child(\"user_chatswith\").child(currentUserId).child(\"chatwith\").child(ownerId);\r\n        databaseReference.addListenerForSingleValueEvent(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                if (snapshot.hasChildren()) {\r\n                    UserListModel user = snapshot.getValue(UserListModel.class);\r\n                    setChatId(user.getChatid());\r\n                    Intent intent = new Intent(context, ChatActivity.class);\r\n                    intent.putExtra(\"firstuser\", currentUserId);\r\n                    intent.putExtra(\"seconduser\", ownerId);\r\n                    intent.putExtra(\"chatid\", chatId + \"\");\r\n                    startActivity(intent);\r\n                } else {\r\n                    DatabaseReference user_chatswithReference = firebaseDatabase.getReference().child(\"user_chatswith\").child(currentUserId).child(\"chatwith\").child(ownerId);\r\n                    DatabaseReference user_chatswithReference1 = firebaseDatabase.getReference().child(\"user_chatswith\");\r\n\r\n                    chatId = user_chatswithReference.push().getKey();\r\n                    UserListModel users1 = new UserListModel();\r\n                    users1.setChatid(chatId);\r\n                    users1.setUserid(ownerId);\r\n                    user_chatswithReference1.child(currentUserId).child(\"chatwith\").child(ownerId).setValue(users1);\r\n\r\n                    UserListModel users2 = new UserListModel();\r\n                    users2.setChatid(chatId);\r\n                    users2.setUserid(currentUserId);\r\n                    user_chatswithReference1.child(ownerId).child(\"chatwith\").child(currentUserId).setValue(users2);\r\n                    Intent intent = new Intent(getContext(), ChatActivity.class);\r\n                    intent.putExtra(\"firstuser\", currentUserId);\r\n                    intent.putExtra(\"seconduser\", ownerId);\r\n                    intent.putExtra(\"chatid\", chatId + \"\");\r\n                    startActivity(intent);\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n                Toast.makeText(getContext(), error.getMessage(), Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/BottomSheetDialog.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/BottomSheetDialog.java	(date 1620583978883)
@@ -61,7 +61,9 @@
         recepientName = bundle.getString("recepientName", "");
         callerName = bundle.getString("callerName");
 
+
         callButton.setOnClickListener(v1 -> {
+
             processCall();
             dismiss();
         });
Index: app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity1.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.actvities;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.view.View;\r\nimport android.widget.ImageButton;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\n\r\nimport static com.example.dhruv.pg_accomodation.helper_classes.ValidationUtility.isValidEmail;\r\nimport static com.example.dhruv.pg_accomodation.helper_classes.ValidationUtility.isValidPassword;\r\n\r\npublic class RegisterActivity1 extends AppCompatActivity {\r\n\r\n    private ImageButton btnBack;\r\n    private MaterialButton btnNext;\r\n\r\n\r\n    private TextInputEditText emailEditText, passwordEditText;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_register1);\r\n        //edit texts\r\n        emailEditText = findViewById(R.id.email_edittext_reg1);\r\n        passwordEditText = findViewById(R.id.password_edittext_reg1);\r\n\r\n        //buttons\r\n        btnBack = (ImageButton) findViewById(R.id.btn_back);\r\n        btnNext = (MaterialButton) findViewById(R.id.btn_next);\r\n\r\n        //go back btn\r\n        btnBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(RegisterActivity1.this, WelcomeActivity.class));\r\n            }\r\n        });\r\n\r\n\r\n        // go next btn\r\n        btnNext.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                String email = emailEditText.getText().toString();\r\n                String password = passwordEditText.getText().toString();\r\n\r\n                if (isValidEmail(email) && isValidPassword(password)) {\r\n                    Intent intent = new Intent(RegisterActivity1.this, RegisterActivity2.class);\r\n                    intent.putExtra(\"email\", email);\r\n                    intent.putExtra(\"password\", password);\r\n                    startActivity(intent);\r\n                } else {\r\n                    emailEditText.setError(\"Invalid email id\");\r\n                    passwordEditText.setError(\"Invalid password(Must be at least 8 character)!\");\r\n                }\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    @Override\r\n    protected void onPause() {\r\n        super.onPause();\r\n        emailEditText.setError(null);\r\n        passwordEditText.setError(null);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity1.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/actvities/RegisterActivity1.java	(date 1620558258460)
@@ -18,8 +18,6 @@
 
     private ImageButton btnBack;
     private MaterialButton btnNext;
-
-
     private TextInputEditText emailEditText, passwordEditText;
 
     @Override
Index: app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/ValidationUtility.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.helper_classes;\r\n\r\nimport android.content.Context;\r\nimport android.net.ConnectivityManager;\r\nimport android.text.TextUtils;\r\nimport android.util.Patterns;\r\nimport android.widget.Toast;\r\n\r\nimport com.example.dhruv.pg_accomodation.Home;\r\n\r\nimport java.util.regex.Matcher;\r\nimport java.util.regex.Pattern;\r\n\r\npublic class ValidationUtility {\r\n\r\n    public static boolean isInternetAvailable(Context context){\r\n        ConnectivityManager connectivityManager=(ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);\r\n        if ( connectivityManager.getActiveNetworkInfo() != null && connectivityManager.getActiveNetworkInfo().isConnected() ) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public static boolean isValidEmail(CharSequence target) {\r\n        return (!TextUtils.isEmpty(target) && Patterns.EMAIL_ADDRESS.matcher(target).matches());\r\n    }\r\n\r\n\r\n    public static boolean isValidateCity(String city){\r\n        if(city.isEmpty()){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public static boolean isValidateDescription(String desc){\r\n        if(desc==null || desc.isEmpty() || desc.length()<20){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public static boolean isValidateFacility(String facility){\r\n        if(facility==null || facility.isEmpty()){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    public static boolean isValidPassword(String s) {\r\n        Pattern PASSWORD_PATTERN\r\n                = Pattern.compile(\r\n                \"[a-zA-Z0-9\\\\!\\\\@\\\\#\\\\$]{8,24}\");\r\n        return !TextUtils.isEmpty(s) && PASSWORD_PATTERN.matcher(s).matches();\r\n    }\r\n\r\n    public static boolean isValidMobile(String phone) {\r\n        return android.util.Patterns.PHONE.matcher(phone).matches();\r\n    }\r\n\r\n    public static boolean isValidUsername(String name) {\r\n        String regex = \"^[A-Za-z]\\\\w{3,29}$\";\r\n\r\n        Pattern p = Pattern.compile(regex);\r\n        if (name == null) {\r\n            return false;\r\n        }\r\n\r\n        Matcher m = p.matcher(name);\r\n        return m.matches();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/ValidationUtility.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/helper_classes/ValidationUtility.java	(date 1620558308430)
@@ -25,7 +25,6 @@
         return (!TextUtils.isEmpty(target) && Patterns.EMAIL_ADDRESS.matcher(target).matches());
     }
 
-
     public static boolean isValidateCity(String city){
         if(city.isEmpty()){
             return false;
Index: app/src/main/java/com/example/dhruv/pg_accomodation/call_support/CallScreenActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.call_support;\r\n\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.example.dhruv.pg_accomodation.actvities.ViewPostActivity;\r\nimport com.example.dhruv.pg_accomodation.fragments.HomeFragment;\r\nimport com.google.android.material.button.MaterialButton;\r\nimport com.sinch.android.rtc.AudioController;\r\nimport com.sinch.android.rtc.PushPair;\r\nimport com.sinch.android.rtc.calling.Call;\r\nimport com.sinch.android.rtc.calling.CallEndCause;\r\nimport com.sinch.android.rtc.calling.CallListener;\r\n\r\nimport android.content.Intent;\r\nimport android.media.AudioManager;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.view.View.OnClickListener;\r\nimport android.widget.Button;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport java.util.List;\r\nimport java.util.Locale;\r\nimport java.util.Timer;\r\nimport java.util.TimerTask;\r\n\r\npublic class CallScreenActivity extends BaseActivity {\r\n\r\n    static final String TAG = CallScreenActivity.class.getSimpleName();\r\n\r\n    private AudioPlayer mAudioPlayer;\r\n    private Timer mTimer;\r\n    private UpdateCallDurationTask mDurationTask;\r\n\r\n    private String recepientName;\r\n    private String mCallId;\r\n\r\n    private TextView mCallDuration;\r\n    private TextView mCallState;\r\n    private TextView mCallerName;\r\n\r\n    private class UpdateCallDurationTask extends TimerTask {\r\n\r\n        @Override\r\n        public void run() {\r\n            CallScreenActivity.this.runOnUiThread(new Runnable() {\r\n                @Override\r\n                public void run() {\r\n                    updateCallDuration();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.callscreen);\r\n\r\n        recepientName = getIntent().getStringExtra(\"recepientName\");\r\n        mAudioPlayer = new AudioPlayer(this);\r\n        mCallDuration = (TextView) findViewById(R.id.callDuration);\r\n        mCallerName = (TextView) findViewById(R.id.remoteUser);\r\n        mCallState = (TextView) findViewById(R.id.callState);\r\n        MaterialButton endCallButton =findViewById(R.id.hangupButton);\r\n\r\n        endCallButton.setOnClickListener(new OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                endCall();\r\n            }\r\n        });\r\n        mCallId = getIntent().getStringExtra(SinchService.CALL_ID);\r\n    }\r\n\r\n    @Override\r\n    public void onServiceConnected() {\r\n        Call call = getSinchServiceInterface().getCall(mCallId);\r\n        if (call != null) {\r\n            call.addCallListener(new SinchCallListener());\r\n            mCallerName.setText(recepientName);\r\n            mCallState.setText(call.getState().toString());\r\n        } else {\r\n            Log.e(TAG, \"Started with invalid callId, aborting.\");\r\n            finish();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onPause() {\r\n        super.onPause();\r\n        mDurationTask.cancel();\r\n        mTimer.cancel();\r\n    }\r\n\r\n    @Override\r\n    public void onResume() {\r\n        super.onResume();\r\n        mTimer = new Timer();\r\n        mDurationTask = new UpdateCallDurationTask();\r\n        mTimer.schedule(mDurationTask, 0, 500);\r\n    }\r\n\r\n    @Override\r\n    public void onBackPressed() {\r\n        // User should exit activity by ending call, not by going back.\r\n    }\r\n\r\n    private void endCall() {\r\n        mAudioPlayer.stopProgressTone();\r\n        Call call = getSinchServiceInterface().getCall(mCallId);\r\n        if (call != null) {\r\n            call.hangup();\r\n        }\r\n        //Intent intent = new Intent(this, HomeFragment.class);\r\n        //startActivity(intent);\r\n        finish();\r\n    }\r\n\r\n    private String formatTimespan(int totalSeconds) {\r\n        long minutes = totalSeconds / 60;\r\n        long seconds = totalSeconds % 60;\r\n        return String.format(Locale.US, \"%02d:%02d\", minutes, seconds);\r\n    }\r\n\r\n    private void updateCallDuration() {\r\n        Call call = getSinchServiceInterface().getCall(mCallId);\r\n        if (call != null) {\r\n            mCallDuration.setText(formatTimespan(call.getDetails().getDuration()));\r\n        }\r\n    }\r\n\r\n    private class SinchCallListener implements CallListener {\r\n\r\n        @Override\r\n        public void onCallEnded(Call call) {\r\n            CallEndCause cause = call.getDetails().getEndCause();\r\n            Log.d(TAG, \"Call ended. Reason: \" + cause.toString());\r\n            mAudioPlayer.stopProgressTone();\r\n            setVolumeControlStream(AudioManager.USE_DEFAULT_STREAM_TYPE);\r\n            String endMsg = \"Call ended: \" + call.getDetails().toString();\r\n            Toast.makeText(CallScreenActivity.this, endMsg, Toast.LENGTH_LONG).show();\r\n            endCall();\r\n        }\r\n\r\n        @Override\r\n        public void onCallEstablished(Call call) {\r\n            Log.d(TAG, \"Call established\");\r\n            mAudioPlayer.stopProgressTone();\r\n            mCallState.setText(call.getState().toString());\r\n            setVolumeControlStream(AudioManager.STREAM_VOICE_CALL);\r\n            AudioController audioController = getSinchServiceInterface().getAudioController();\r\n            audioController.disableSpeaker();\r\n            audioController.enableAutomaticAudioRouting(true, AudioController.UseSpeakerphone.SPEAKERPHONE_AUTO);\r\n        }\r\n\r\n        @Override\r\n        public void onCallProgressing(Call call) {\r\n            Log.d(TAG, \"Call progressing\");\r\n            mAudioPlayer.playProgressTone();\r\n        }\r\n\r\n        @Override\r\n        public void onShouldSendPushNotification(Call call, List<PushPair> pushPairs) {\r\n            // Send a push through your push provider here, e.g. GCM\r\n        }\r\n\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/call_support/CallScreenActivity.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/call_support/CallScreenActivity.java	(date 1620585875263)
@@ -59,6 +59,7 @@
         setContentView(R.layout.callscreen);
 
         recepientName = getIntent().getStringExtra("recepientName");
+
         mAudioPlayer = new AudioPlayer(this);
         mCallDuration = (TextView) findViewById(R.id.callDuration);
         mCallerName = (TextView) findViewById(R.id.remoteUser);
@@ -165,6 +166,5 @@
         public void onShouldSendPushNotification(Call call, List<PushPair> pushPairs) {
             // Send a push through your push provider here, e.g. GCM
         }
-
     }
 }
Index: app/src/main/java/com/example/dhruv/pg_accomodation/actvities/WelcomeActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.dhruv.pg_accomodation.actvities;\r\n\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.text.Html;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.view.Window;\r\nimport android.view.WindowManager;\r\nimport android.widget.Button;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.viewpager.widget.PagerAdapter;\r\nimport androidx.viewpager.widget.ViewPager;\r\n\r\nimport com.example.dhruv.pg_accomodation.Home;\r\nimport com.example.dhruv.pg_accomodation.call_support.BaseActivity;\r\nimport com.example.dhruv.pg_accomodation.call_support.SinchService;\r\nimport com.example.dhruv.pg_accomodation.helper_classes.PrefManager;\r\nimport com.example.dhruv.pg_accomodation.R;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.sinch.android.rtc.SinchError;\r\n\r\npublic class WelcomeActivity extends BaseActivity implements SinchService.StartFailedListener {\r\n\r\n    private ViewPager viewPager;\r\n    private MyViewPagerAdapter myViewPagerAdapter;\r\n    private LinearLayout dotsLayout;\r\n    private TextView[] dots;\r\n    private int[] layouts;\r\n    private Button btnRegister, btnLogin;\r\n    private PrefManager prefManager;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n\r\n        requestWindowFeature(Window.FEATURE_NO_TITLE);\r\n        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,\r\n                WindowManager.LayoutParams.FLAG_FULLSCREEN);\r\n\r\n        setContentView(R.layout.activity_welcome);\r\n        prefManager = new PrefManager(this);\r\n        if (prefManager.isIsLoggedIn()) {\r\n            FirebaseDatabase.getInstance().setPersistenceEnabled(true);\r\n\r\n            startActivity(new Intent(WelcomeActivity.this, Home.class));\r\n            finish();\r\n        }\r\n\r\n        viewPager = findViewById(R.id.view_pager);\r\n        dotsLayout = findViewById(R.id.layoutDots);\r\n        btnRegister = findViewById(R.id.btn_register);\r\n        btnLogin = findViewById(R.id.btn_login);\r\n\r\n\r\n        // layouts of welcome sliders\r\n        layouts = new int[]{\r\n                R.layout.welcome_slide1,\r\n                R.layout.welcome_slide2,\r\n                R.layout.welcome_slide3,\r\n                R.layout.welcome_slide4\r\n        };\r\n\r\n        // adding bottom dots\r\n        addBottomDots(0);\r\n\r\n        // making notification bar transparent\r\n        if (Build.VERSION.SDK_INT >= 21) {\r\n            getWindow().getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN);\r\n        }\r\n        //changeStatusBarColor();\r\n\r\n        myViewPagerAdapter = new MyViewPagerAdapter();\r\n        viewPager.setAdapter(myViewPagerAdapter);\r\n        viewPager.addOnPageChangeListener(viewPagerPageChangeListener);\r\n\r\n        // go to register activity\r\n        btnRegister.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(WelcomeActivity.this, RegisterActivity1.class));\r\n            }\r\n        });\r\n\r\n\r\n        // go to login screen\r\n        btnLogin.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startActivity(new Intent(WelcomeActivity.this, LoginActivity.class));\r\n            }\r\n        });\r\n    }\r\n\r\n    private void addBottomDots(int currentPage) {\r\n        dots = new TextView[layouts.length];\r\n\r\n        int[] colorsActive = getResources().getIntArray(R.array.array_dot_active);\r\n        int[] colorsInactive = getResources().getIntArray(R.array.array_dot_inactive);\r\n\r\n        dotsLayout.removeAllViews();\r\n\r\n        for (int i = 0; i < dots.length; i++) {\r\n            dots[i] = new TextView(this);\r\n            dots[i].setText(Html.fromHtml(\"&#9679;\"));\r\n            dots[i].setTextSize(20);\r\n            dots[i].setTextColor(colorsInactive[currentPage]);\r\n            dotsLayout.addView(dots[i]);\r\n\r\n        }\r\n\r\n        if (dots.length > 0)\r\n            dots[currentPage].setTextColor(colorsActive[currentPage]);\r\n    }\r\n\r\n    private int getItem(int i) {\r\n        return viewPager.getCurrentItem() + i;\r\n    }\r\n\r\n    //  viewpager change listener\r\n    ViewPager.OnPageChangeListener viewPagerPageChangeListener = new ViewPager.OnPageChangeListener() {\r\n\r\n        @Override\r\n        public void onPageSelected(int position) {\r\n            addBottomDots(position);\r\n        }\r\n\r\n        @Override\r\n        public void onPageScrolled(int arg0, float arg1, int arg2) {\r\n        }\r\n\r\n        @Override\r\n        public void onPageScrollStateChanged(int arg0) {\r\n        }\r\n    };\r\n\r\n    @Override\r\n    protected void onServiceConnected() {\r\n        getSinchServiceInterface().setStartListener(this);\r\n        startCallListening();\r\n    }\r\n\r\n    @Override\r\n    public void onStartFailed(SinchError error) {\r\n        Toast.makeText(this, error.toString(), Toast.LENGTH_LONG).show();\r\n    }\r\n\r\n    @Override\r\n    public void onStarted() { }\r\n\r\n\r\n    private void startCallListening() {\r\n\r\n        String userName = prefManager.getCallerID();\r\n        if (userName.isEmpty()) {\r\n            Toast.makeText(this, \"Please enter a name\", Toast.LENGTH_LONG).show();\r\n            return;\r\n        }\r\n\r\n        if (!userName.equals(getSinchServiceInterface().getUserName())) {\r\n            getSinchServiceInterface().stopClient();\r\n        }\r\n\r\n        if (!getSinchServiceInterface().isStarted()) {\r\n            getSinchServiceInterface().startClient(userName);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * View pager adapter\r\n     */\r\n    public class MyViewPagerAdapter extends PagerAdapter {\r\n        private LayoutInflater layoutInflater;\r\n\r\n        public MyViewPagerAdapter() { }\r\n\r\n        @Override\r\n        public Object instantiateItem(ViewGroup container, int position) {\r\n            layoutInflater = (LayoutInflater) getSystemService(Context.LAYOUT_INFLATER_SERVICE);\r\n\r\n            View view = layoutInflater.inflate(layouts[position], container, false);\r\n            container.addView(view);\r\n\r\n            return view;\r\n        }\r\n\r\n        @Override\r\n        public int getCount() {\r\n            return layouts.length;\r\n        }\r\n\r\n        @Override\r\n        public boolean isViewFromObject(View view, Object obj) {\r\n            return view == obj;\r\n        }\r\n\r\n        @Override\r\n        public void destroyItem(ViewGroup container, int position, Object object) {\r\n            View view = (View) object;\r\n            container.removeView(view);\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/dhruv/pg_accomodation/actvities/WelcomeActivity.java	(revision 208a8e6ba9d64680ce7e6729b807b0cba2d6c9d9)
+++ app/src/main/java/com/example/dhruv/pg_accomodation/actvities/WelcomeActivity.java	(date 1620557937281)
@@ -48,6 +48,7 @@
 
         setContentView(R.layout.activity_welcome);
         prefManager = new PrefManager(this);
+
         if (prefManager.isIsLoggedIn()) {
             FirebaseDatabase.getInstance().setPersistenceEnabled(true);
 
